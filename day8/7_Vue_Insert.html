<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"
        integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>

<body>
    <div id="app">
        <h2>학생추가</h2>
        <div>
            학번 : <input v-model="stuNo">
            <button @click="fnDoubleCheck">중복체크</button>
        </div>
        <div>이름 : <input v-model="name"></div>
        <div>학과 : <input v-model="dept"></div>
        <div>
            <button @click="fnAdd">추가</button>
            <button @click="fnBack">되돌아가기</button>
        </div>
    </div>
</body>

</html>

<script>
    const app = Vue.createApp({
        data() {
            return {
                // 변수 - (key : value)
                stuNo: "",
                name: "",
                dept: ""
            };
        },
        methods: {
            // 함수(메소드) - (key : function())
            fnAdd: function () {
                let self = this;
                let length1;
                if (self.stuNo.length != 8) {
                    // alert(stuNo);
                    alert("학번은 8글자입니다")
                    return;
                }
                console.log("첫번째 서치 함수 시작 직전");
                $.ajax({
                    url: "http://localhost:3009/search",
                    dataType: "json",
                    type: "GET",
                    data: {
                        stuNo: self.stuNo//, 
                        // name: self.name, 
                        // dept: self.dept 
                    },
                    success: function (data) {
                        // alert("중복체크 했습니다.");
                        console.log(data);
                        if (data.length == 0) {
                            alert("없는 학번이네요 추가 가능");
                            length1 = data.length;
                            alert(length1);
                            if (length1 == 0) {
                                console.log("두번째 인서트 함수 시작 직전");
                                $.ajax({
                                    url: "http://localhost:3009/insert",
                                    dataType: "json",
                                    type: "GET",
                                    data: {
                                        stuNo: self.stuNo,
                                        name: self.name,
                                        dept: self.dept
                                    },
                                    success: function (data) {
                                        alert("추가되었습니다.");
                                        self.fnBack();
                                    }
                                })
                            };
                        }
                        if (data.length == 1) {
                            length1 = data.length;
                            alert("중복체크 통과 후 추가해주세요 (현재는 추가불가)");
                            return;
                        }
                        // self.fnBack();
                    }
                });

            },
            fnBack: function () {
                location.href = "6_Vue_CRUD.html";
            },
            fnDoubleCheck: function () {
                let self = this;
                if (self.stuNo.length != 8) {
                    // alert(stuNo);
                    alert("중복체크중... 학번은 8글자입니다")
                    return;
                }
                $.ajax({
                    url: "http://localhost:3009/search",
                    dataType: "json",
                    type: "GET",
                    data: {
                        stuNo: self.stuNo//, 
                        // name: self.name, 
                        // dept: self.dept 
                    },
                    success: function (data) {
                        alert("중복체크 했습니다.");
                        console.log(data);
                        if (data.length == 0) {
                            alert("없는 학번이네요 추가버튼 클릭시 insert 실행됩니다.");
                        }
                        if (data.length == 1) {
                            alert("있는 학번이네요. 학번바꾸세요");
                        }
                        // self.fnBack();
                    }
                });
            }
        },
        mounted() {
            // 처음 시작할 때 실행되는 부분
        }
    });

    app.mount('#app');
</script>